import {
  Cog8ToothIcon,
  DocumentDuplicateIcon,
  MagnifyingGlassIcon,
  PlayIcon,
  SquaresPlusIcon,
  StopIcon,
  UserCircleIcon,
} from '@heroicons/react/24/outline/';
import { type NextPage } from 'next';
import Head from 'next/head';
import { useState } from 'react';
import SimpleBar from 'simplebar-react';
import { DocumentMenu, Editor, SearchMenu, Skills, Tabs } from '../components';
import { useDocumentsStore } from '../stores';
import { clg, findParents } from '../utils';

// const MotionLeftMenuBar = motion(LeftMenuBar);

const Home: NextPage = () => {
  const documents = useDocumentsStore((state) => state.documents);

  // Active file
  const activeFile = useDocumentsStore((state) => state.activeFile);
  // Show menu
  const showMenu = useDocumentsStore((state) => state.showMenu);
  const toggleMenu = useDocumentsStore((state) => state.toggleMenu);

  const [activeRunnableComponent, setActiveRunnableComponent] = useState<string>('');
  // TODO: run like code
  const handleRunCode = () => {
    // Get active parent
    const parents = findParents(activeFile, documents);
    const activeTopParent = parents[parents.length - 1];

    if (activeTopParent?.type === 'FOLDER' && activeTopParent.isRunnable) {
      // console.log('run code', activeTopParent.title);
      toggleMenu('runMenu');
      setActiveRunnableComponent(activeTopParent.title);
    }

    // console.log(activeTopParent);
  };

  return (
    <>
      <Head>
        <title>Create T3 App</title>
        <meta name="description" content="Generated by create-t3-app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      {/* <main className="flex min-h-screen flex-col items-center justify-center bg-gradient-to-b from-[#2e026d] to-[#15162c]"> */}
      <main className="relative h-screen overflow-hidden bg-slate-900 md:p-16">
        {/* Window */}
        <div className="relative flex h-full flex-col rounded-2xl bg-gradient-to-br from-slate-400/40 to-slate-400/0 p-4 md:flex-row ">
          {/* Icon Indicator Line */}
          {/* <div className="absolute top-[40px] -left-4 h-[1px] w-8 rotate-90 bg-cyan-300 blur-[1px]" /> */}
          {/* Left Icon Bar */}
          <div className="order-1 flex justify-between p-2 md:order-none md:flex-col">
            <DocumentDuplicateIcon
              className={clg(
                'h-6 w-6 cursor-pointer md:mb-8 md:h-8 md:w-8',
                { 'text-slate-100': showMenu.documentMenu },
                { 'text-slate-400': !showMenu.documentMenu }
              )}
              onClick={() => toggleMenu('documentMenu')}
            />
            <MagnifyingGlassIcon
              className={clg(
                'h-6 w-6 cursor-pointer md:mb-8 md:h-8 md:w-8',
                { 'text-slate-100': showMenu.searchMenu },
                { 'text-slate-400': !showMenu.searchMenu }
              )}
              onClick={() => toggleMenu('searchMenu')}
            />
            <SquaresPlusIcon className="h-6 w-6 cursor-pointer text-slate-400 md:mb-8 md:h-8 md:w-8" />
            {showMenu.runMenu ? (
              <StopIcon
                className="h-6 w-6 cursor-pointer text-slate-100 md:mb-auto md:h-8 md:w-8"
                onClick={handleRunCode}
              />
            ) : (
              <PlayIcon
                className="h-6 w-6 cursor-pointer text-slate-400 md:mb-auto md:h-8 md:w-8"
                onClick={handleRunCode}
              />
            )}

            <UserCircleIcon className="h-6 w-6 text-slate-400 md:mb-4 md:h-8 md:w-8" />
            <Cog8ToothIcon className="h-6 w-6 text-slate-400 md:h-8 md:w-8" />
          </div>
          {/* For Mobile Responsive */}
          <div className="flex h-full w-full overflow-hidden">
            {/* Left Menu Bar */}
            {/* TODO: add animation */}
            {showMenu.documentMenu && <DocumentMenu />}
            {showMenu.searchMenu && <SearchMenu />}
            {/* BODY */}
            <div
              className={clg('flex w-full flex-col gap-2 overflow-hidden p-2', {
                'hidden md:flex': showMenu.documentMenu || showMenu.searchMenu, // TODO: add other menus for mobile
              })}
              // TODO:Just for mobile
              // aria-hidden={!showMenu.leftMenuBar}
            >
              {/* TABS */}
              <Tabs title={showMenu.runMenu ? activeRunnableComponent : undefined} />
              {/* EDITOR & Runnable Component */}
              {showMenu.runMenu ? (
                <SimpleBar className="h-full w-full overflow-auto">
                  {activeRunnableComponent === 'Skills' && <Skills />}
                </SimpleBar>
              ) : (
                <Editor />
              )}
            </div>
          </div>
        </div>
        {/* Circles */}
        <div className="absolute right-16 top-16 h-[60px] w-[60px] rounded-full bg-cyan-300 mix-blend-screen blur-3xl md:right-32 md:top-60 md:h-[100px] md:w-[100px]" />
        <div className="absolute left-16 bottom-16 h-[60px] w-[60px] rounded-full bg-cyan-300 mix-blend-screen blur-3xl md:left-96 md:bottom-36 md:h-[100px] md:w-[100px]" />
      </main>
    </>
  );
};

export default Home;
// TODO: remove when complete https://codesandbox.io/s/hungry-pine-k7g0y9?file=/src/document.js:166-187
